<!DOCTYPE html>
<html>
  <head>
    <title>Shader Art</title>
    <script src="https://ordinals.com/content/7e37766541506810ba6399c4b2735121f508bd9209df43dd200bf2316b014594i0"></script>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000000;
        }
        canvas {
            width: 100% !important;
            height: 100% !important;
            object-fit: contain !important;
            max-width: 100vw;
            max-height: 100vh;
        }
        main {
            display: flex;
            justify-content: center;
            width: 100%;
            align-items: center;
            height: 100%;
        }
    </style>
  </head>
  <body>
    <div id="keyboard-controls-panel" style="position:fixed;top:19px;right:19px;z-index:1000;min-width:256px;max-width:336px;background:rgba(20,20,20,0.82);border:1.5px solid #fff;border-radius:10px;padding:14px 17px 14px 17px;color:#fff;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Helvetica Neue',Arial,sans-serif;font-size:12px;line-height:1.36;box-shadow:0 2px 16px 0 rgba(0,0,0,0.18);backdrop-filter:blur(2px);display:none;">
      <b style="font-size:13.5px;letter-spacing:1px;font-weight:600;">Interaction Controls</b><br><br>
      <b style="font-weight:500;">Y</b><span style="font-weight:400;">: Cycle zoom levels</span><br>
      <b style="font-weight:500;">A</b><span style="font-weight:400;">: Change aspect ratio</span><br>
      <b style="font-weight:500;">Right Mouse</b><span style="font-weight:400;">: Pan/drag the view</span><br>
      <br>
      <b style="font-weight:500;">B</b><span style="font-weight:400;">: Cycle color mode</span><br>
      <b style="font-weight:500;">X</b><span style="font-weight:400;">: Toggle alt mode</span><br>
      <br>
      <b style="font-weight:500;">S</b><span style="font-weight:400;">: Toggle orbs rotation</span><br>
      <b style="font-weight:500;">D</b><span style="font-weight:400;">: Toggle orbs alignment</span><br>
      <b style="font-weight:500;">F</b><span style="font-weight:400;">: Toggle orbs movement</span><br>
      <br>
      <b style="font-weight:500;">Q</b><span style="font-weight:400;">: Save curr position</span><br>
      <span style="font-size:11px;color:#bbb;display:inline-block;min-width:180px;white-space:nowrap;">(download position metadata)</span><br>
      <b style="font-weight:500;">E</b><span style="font-weight:400;">: Restore saved position</span><br>
      <b style="font-weight:500;">R</b><span style="font-weight:400;">: Reset position</span><br>
      <br>
      <b style="font-weight:500;">1/2/3</b><span style="font-weight:400;">: Save PNG - incremental resolution</span><br>
      <b style="font-weight:500;">C</b><span style="font-weight:400;">: Start/stop animation recording</span><br>
      <br>
      <b style="font-weight:500;">I</b><span style="font-weight:400;">: Show/hide Interaction Controls Panel</span><br>
    </div>
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec3 aPosition;
        attribute vec2 aTexCoord;
        varying vec2 vteCd;
        void main() {
            vteCd = aTexCoord;
            vec4 positionVec4 = vec4(aPosition, 1.0);
            positionVec4.xy = positionVec4.xy * 2.0 - 1.0;
            gl_Position = positionVec4;
        }
    </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
#ifdef GL_ES
precision mediump float;
precision lowp int;
#endif
#define M_PI 3.14159265358979323846
varying vec2 vteCd;
uniform vec2 u_res;
uniform float u_time;
uniform float u_celS;
uniform float u_noSc;
uniform float u_maxDepth;
uniform float u_floS;
uniform float u_nS;
uniform float u_rSS;
uniform float u_roA;
uniform vec2 u_nOS;
uniform float u_amp;
uniform float u_scFa;
uniform vec2 u_tran;
uniform float u_inFr;
uniform float u_bS;
uniform float u_soStr;
uniform float u_soFr;
uniform float u_soAnS;
uniform int u_cuPa;
uniform float u_baMo;
uniform vec4 u_baCo;
uniform vec3 u_rC1;
uniform vec3 u_rC2;
uniform vec3 u_rC3;
uniform vec3 u_rC4;
uniform vec3 u_rC5;
uniform vec3 u_rC6;
uniform vec3 u_rC7;
uniform vec3 u_rC8;
uniform vec3 u_rC9;
uniform vec3 u_rC10;
uniform float u_cuNoSc;
uniform vec2 u_sTran;
uniform bool u_enDWa;
uniform bool u_fPat;
uniform bool u_isLBa;
uniform float u_caSVa;
uniform float u_reQu;
uniform bool u_enMi;
uniform bool u_enVMi;
uniform int u_hoMiS;
uniform float u_patRC;
uniform int u_bMo;
uniform float u_coMvT;
uniform float u_coMvS;
lowp float smTran(lowp float value,lowp float prVal,lowp float smFac){return mix(prVal,value,smFac);}
lowp vec2 smVec(lowp vec2 curr,lowp vec2 prev,lowp float smFac){return mix(prev,curr,smFac);}
lowp vec2 getFDir(lowp vec2 position,float time);
lowp vec2 getSFDir(lowp vec2 position,float time){lowp vec2 currFlow=getFDir(position,time);lowp vec2 prevFlow=getFDir(position,time-0.016);return smVec(currFlow,prevFlow,0.2);}
lowp vec3 muBl(lowp vec3 a,lowp vec3 b){return a*b;}
lowp float random(vec2 st,float seed){vec2 p=st+seed;return fract(sin(dot(p,vec2(12.9898,78.233)))*43758.5453);}
lowp float noise(vec2 st,float seed){vec2 i=floor(st);vec2 f=fract(st);lowp vec2 u=f*f*(3.0-2.0*f);lowp float a=random(i,seed);lowp float b=random(i+vec2(1.0,0.0),seed);lowp float c=random(i+vec2(0.0,1.0),seed);lowp float d=random(i+vec2(1.0,1.0),seed);return mix(a+(b-a)*u.x,c+(d-c)*u.x,u.y);}
lowp vec3 mod289(vec3 x){return x-floor(x/289.0)*289.0;}
lowp vec2 mod289(vec2 x){return x-floor(x/289.0)*289.0;}
lowp vec3 permute(vec3 x){return mod289((x*34.0+1.0)*x);}
lowp vec2 cellular(lowp vec2 P){lowp float d1=1.0;lowp float d2=1.0;lowp vec2 i=floor(P);lowp vec2 f=fract(P);for(int y=-1;y<=1;y++){for(int x=-1;x<=1;x++){lowp vec2 neighbor=vec2(float(x),float(y));lowp vec2 point=neighbor+vec2(random(i+neighbor,1.0),random(i+neighbor,2.0));lowp float d=length(point-f);if(d<d1){d2=d1;d1=d;}else if(d<d2){d2=d;}}}return vec2(d1,d2);}
lowp float celNo(lowp vec2 v){v*=2.0;v+=u_time*0.1;lowp vec2 distances=cellular(v);lowp float pattern1=distances.y-distances.x;lowp float pattern2=distances.x*distances.y;lowp float pattern3=1.0-distances.x;float t=fract(u_time*0.5);mediump float finalPattern=mix(mix(pattern1,pattern2,t),pattern3,sin(u_time*0.5)*0.5+0.5);return(finalPattern*2.0-1.0);}
mediump float sxNo(mediump vec2 v,float time,vec2 direction){float angle1=v.x+v.y+time*0.1;float angle2=v.x-v.y-time*0.15;float angle3=length(v)+time*0.05;float cross=sin(v.x*6.0)*sin(v.y*6.0);float pattern=(sin(angle1*4.0+cross)+sin(angle2*3.0-cross*0.5)+sin(angle3*5.0+cross*0.3))/3.0;return pattern;}
mediump float sxNo(mediump vec2 v,float time){return sxNo(v,u_time,vec2(1.0,1.0));}
lowp float fastSin(float x){x=mod(x+M_PI,2.0*M_PI)-M_PI;float x2=x*x;return x*(1.0-x2/(3.0*2.0)+x2*x2/(5.0*4.0*3.0*2.0));}
lowp float fastCos(float x){return fastSin(x+M_PI*0.5);}
vec2 domWa(vec2 p,float time){return p;}
float laNo(vec2 p,float time){vec2 direction=vec2(0.7,1.3);return sxNo(p,u_time*0.03,direction);}
lowp float fbmsxNo(lowp vec2 v,int octaves){float value=0.0;float amplitude=1.0;float frequency=1.0;float maxAmplitude=0.0;for(int i=0;i<10;i++){if(i>=octaves)break;value+=amplitude*sxNo(v*frequency,u_time*0.3,vec2(1.0,1.0));maxAmplitude+=amplitude;frequency*=2.0;amplitude*=0.5;}return u_amp*value/maxAmplitude*u_baMo;}
lowp vec3 gCFPal(float t,vec2 position){float smoothedT=t;float scaledT=smoothedT*9.0;float integerPart=floor(scaledT);float fractionalPart=scaledT-integerPart;float blendFactor=smoothstep(0.0,1.0,fractionalPart);vec3 color1;vec3 color2;if(integerPart<1.0){color1=u_rC1;color2=u_rC2;}else if(integerPart<2.0){color1=u_rC2;color2=u_rC3;}else if(integerPart<3.0){color1=u_rC3;color2=u_rC4;}else if(integerPart<4.0){color1=u_rC4;color2=u_rC5;}else if(integerPart<5.0){color1=u_rC5;color2=u_rC6;}else if(integerPart<6.0){color1=u_rC6;color2=u_rC7;}else if(integerPart<7.0){color1=u_rC7;color2=u_rC8;}else if(integerPart<8.0){color1=u_rC8;color2=u_rC9;}else{color1=u_rC9;color2=u_rC10;}vec3 blendedColor=mix(color1,color2,blendFactor);float luminance=dot(blendedColor,vec3(0.299,0.587,0.114));float saturationFactor=1.5;vec3 saturatedColor=mix(vec3(luminance),blendedColor,saturationFactor);return clamp(saturatedColor,0.0,1.0);}
lowp vec3 sMix(lowp vec3 a,lowp vec3 b,lowp float factor){return mix(a,b,factor);}
lowp vec2 getFDir(lowp vec2 position,float time){lowp vec2 p=position*0.0005;lowp float slowTime=time*0.2;vec2 center1=vec2(sin(slowTime*0.21)*4000.0,cos(slowTime*0.23)*4000.0);vec2 center2=vec2(cos(slowTime*0.27)*5000.0,sin(slowTime*0.29)*5000.0);vec2 center3=vec2(sin(slowTime*0.33)*6000.0,cos(slowTime*0.39)*6000.0);vec2 dir1=normalize(center1-position);vec2 dir2=normalize(center2-position);vec2 dir3=normalize(center3-position);float weight1=0.5+0.5*sin(dot(p,vec2(0.01,0.02))+slowTime*0.3);float weight2=0.5+0.5*cos(dot(p,vec2(0.02,0.01))+slowTime*0.4);float weight3=0.5+0.5*sin(dot(p,vec2(0.015,0.025))+slowTime*0.5);vec2 flow1=mix(dir1,vec2(-dir1.y,dir1.x),0.5+0.5*sin(slowTime*0.51));vec2 flow2=mix(dir2,vec2(-dir2.y,dir2.x),0.5+0.5*cos(slowTime*0.57));vec2 flow3=mix(dir3,vec2(-dir3.y,dir3.x),0.5+0.5*sin(slowTime*0.61));lowp vec2 flow=flow1*weight1+flow2*weight2+flow3*weight3;flow+=vec2(sin(p.x*0.001+p.y*0.002+slowTime*0.2),cos(p.x*0.002-p.y*0.001+slowTime*0.25))*0.7;float len=max(length(flow),0.0001);return flow/len;}
lowp vec4 getCASe(float seed,float iter){float patternSeed=fract(seed*12345.6789+iter*789.123);int patternType=int(mod(patternSeed*4.0,4.0));if(patternType==0){return vec4(0.4,1.3,2.3,0.35);}else if(patternType==1){return vec4(0.15,1.6,2.7,0.5);}else if(patternType==2){return vec4(0.3,1.7,2.2,0.45);}else{return vec4(0.25,1.5,2.5,0.4);}}
lowp float getGPa(lowp vec2 cell,float depth,float seed,lowp vec2 normalizedPos){lowp float distFromCenter=length(cell);if(distFromCenter>10.0){return step(0.7,noise(floor(cell*0.2)*5.0,seed));}lowp vec2 gridPos=floor(cell*0.25)*4.0;lowp float gridValue=max(abs(gridPos.x),abs(gridPos.y))*0.25;lowp float smoothGrid=smoothstep(0.0,4.0,gridValue)*0.5;lowp float scaleVariation=1.0+smoothGrid*2.5*u_caSVa;lowp vec2 scaledCell=floor(cell*scaleVariation)*0.5;lowp vec2 id=floor(scaledCell);lowp float basePattern=noise(floor(id*0.5),seed+floor(depth));lowp float state=step(0.6,basePattern);lowp float angle=atan(scaledCell.y,scaledCell.x);lowp float radius=length(scaledCell);lowp float localPhase=sin(scaledCell.x*3.0)*sin(scaledCell.y*3.0)*sin(length(scaledCell));lowp float timePhase=u_time*0.1+noise(scaledCell,u_nS);lowp float patternVariant=smoothstep(0.3,0.7,localPhase*sin(timePhase));if(length(id)<8.0){lowp float neighbors=0.0;lowp vec2 neighbor=floor(id+vec2(1.0,0.0));neighbors+=smoothstep(0.45,0.55,noise(neighbor*0.5,seed));neighbor=floor(id+vec2(-1.0,0.0));neighbors+=smoothstep(0.45,0.55,noise(neighbor*0.5,seed));neighbor=floor(id+vec2(0.0,1.0));neighbors+=smoothstep(0.45,0.55,noise(neighbor*0.5,seed));neighbor=floor(id+vec2(0.0,-1.0));neighbors+=smoothstep(0.45,0.55,noise(neighbor*0.5,seed));lowp float depthRule=floor(mod(depth+patternVariant,u_patRC));if(depthRule<1.0){lowp float surviveThreshold=1.5;state=smoothstep(surviveThreshold-0.1,surviveThreshold+0.1,neighbors)*smoothstep(surviveThreshold+0.9,surviveThreshold+1.1,neighbors)*state+smoothstep(1.9,2.1,neighbors)*smoothstep(2.9,3.1,neighbors)*(1.0-state);}else if(depthRule<2.0){lowp float edgeThreshold=0.4;state=smoothstep(edgeThreshold-0.02,edgeThreshold+0.02,abs(neighbors-2.0));}else if(depthRule<3.0){state=smoothstep(0.48,0.52,fract(neighbors*(1.0+cos(angle*4.0)*0.2)));}else if(depthRule<4.0){state=smoothstep(0.48,0.52,sin(radius*3.0+angle*4.0)*0.5+0.5);}else if(depthRule<5.0){state=smoothstep(2.48,2.52,neighbors)*state+smoothstep(1.48,1.52,neighbors)*(1.0-state);}else if(depthRule<6.0){state=smoothstep(1.48,1.52,neighbors)*smoothstep(2.48,2.52,neighbors)*(1.0-state)+smoothstep(1.48,1.52,neighbors)*smoothstep(3.48,3.52,neighbors)*state;}else if(depthRule<7.0){state=smoothstep(0.48,0.52,sin(neighbors*1.5+radius))*smoothstep(0.48,0.52,sin(neighbors*2.0+angle*2.0));}else if(depthRule<8.0){state=(1.0-smoothstep(2.98,3.02,neighbors))*(state+smoothstep(1.98,2.02,neighbors)*(1.0-state));}else{state=smoothstep(0.48,0.52,sin(neighbors*2.0+angle*3.0)*sin(radius*2.0+neighbors)*0.5+0.5);}}lowp float geoPattern;if(patternVariant<1.0){geoPattern=step(0.5,sin(radius*3.0+depth)*0.5+0.5);}else if(patternVariant<2.0){geoPattern=step(0.5,sin(angle*4.0+depth)*0.5+0.5);}else if(patternVariant<3.0){geoPattern=step(0.5,fract(scaledCell.x*0.5)+fract(scaledCell.y*0.5));}else if(patternVariant<4.0){geoPattern=step(0.5,sin(radius*angle+depth)*0.5+0.5);}else if(patternVariant<5.0){geoPattern=step(0.5,sin(scaledCell.x*3.0+scaledCell.y*2.0+depth)*0.5+0.5);}else if(patternVariant<6.0){geoPattern=step(0.8,(abs(fract(scaledCell.x*0.5)-0.5)+abs(fract(scaledCell.y*0.5)-0.5)));}else if(patternVariant<7.0){geoPattern=step(0.5,sin(scaledCell.x*5.0)*0.5+0.5);}else{geoPattern=step(0.5,sin(scaledCell.x*10.0)*0.5+0.5)*step(0.5,sin(scaledCell.y*10.0)*0.5+0.5);}return mix(state,geoPattern,0.1);}
lowp vec3 scrBl(lowp vec3 a,lowp vec3 b){return 1.0-(1.0-a)*(1.0-b);}
lowp vec3 ovrBl(lowp vec3 a,lowp vec3 b){return vec3(a.r<0.5?(2.0*a.r*b.r):(1.0-2.0*(1.0-a.r)*(1.0-b.r)),a.g<0.5?(2.0*a.g*b.g):(1.0-2.0*(1.0-a.g)*(1.0-b.g)),a.b<0.5?(2.0*a.b*b.b):(1.0-2.0*(1.0-a.b)*(1.0-b.b)));}
lowp vec3 diffBl(lowp vec3 a,lowp vec3 b){return abs(a-b);}
lowp vec3 excBl(lowp vec3 a,lowp vec3 b){return a+b-2.0*a*b;}
lowp vec3 hLBl(lowp vec3 a,lowp vec3 b){return vec3(b.r<0.5?(2.0*b.r*a.r):(1.0-2.0*(1.0-b.r)*(1.0-a.r)),b.g<0.5?(2.0*b.g*a.g):(1.0-2.0*(1.0-b.g)*(1.0-a.g)),b.b<0.5?(2.0*b.b*a.b):(1.0-2.0*(1.0-b.b)*(1.0-a.b)));}
lowp vec3 sLBl(lowp vec3 a,lowp vec3 b){return vec3(b.r<0.5?(2.0*a.r*b.r+a.r*a.r*(1.0-2.0*b.r)):(2.0*a.r*(1.0-b.r)+sqrt(a.r)*(2.0*b.r-1.0)),b.g<0.5?(2.0*a.g*b.g+a.g*a.g*(1.0-2.0*b.g)):(2.0*a.g*(1.0-b.g)+sqrt(a.g)*(2.0*b.g-1.0)),b.b<0.5?(2.0*a.b*b.b+a.b*a.b*(1.0-2.0*b.b)):(2.0*a.b*(1.0-b.b)+sqrt(a.b)*(2.0*b.b-1.0)));}
lowp vec3 cBBl(lowp vec3 a,lowp vec3 b){return vec3(b.r==0.0?0.0:1.0-min(1.0,(1.0-a.r)/b.r),b.g==0.0?0.0:1.0-min(1.0,(1.0-a.g)/b.g),b.b==0.0?0.0:1.0-min(1.0,(1.0-a.b)/b.b));}
lowp vec3 cDBl(lowp vec3 a,lowp vec3 b){return vec3(b.r==1.0?1.0:min(1.0,a.r/(1.0-b.r)),b.g==1.0?1.0:min(1.0,a.g/(1.0-b.g)),b.b==1.0?1.0:min(1.0,a.b/(1.0-b.b)));}
void main(){const lowp int MAX_LOOP_DEPTH=3;mediump vec2 uv=vteCd.xy;mediump vec2 coord=(uv*u_res-u_res*0.25)*u_scFa+u_tran;coord/=u_bS;mediump vec2 smoothCoord=coord;mediump vec2 visibleCenter=u_tran;mediump float mirrorCenterX=visibleCenter.x-mod(visibleCenter.x,u_celS);if(u_enMi){if(u_hoMiS==0){if(coord.x<=mirrorCenterX){coord.x=2.0*mirrorCenterX-coord.x+0.00001;}}else if(u_hoMiS==1){if(coord.x>=mirrorCenterX){coord.x=2.0*mirrorCenterX-coord.x-0.00001;}}}coord+=u_sTran;mediump float cellOffsetX=mod(visibleCenter.x,u_celS);mediump float cellOffsetY=mod(visibleCenter.y,u_celS);coord.x+=(u_celS*0.5-cellOffsetX);coord.y+=(u_celS*0.5-cellOffsetY);if(u_coMvS>0.0){float columnIndex=floor(coord.x/u_celS);float columnOffset=sin(columnIndex*0.1)*cos(columnIndex*0.23)*u_coMvS;float columnMovement=sin(u_coMvT+columnIndex*0.5)*columnOffset;coord.y+=columnMovement*u_celS;}mediump float globalAngle=atan(coord.y,coord.x);mediump float globalDist=length(coord);lowp float nearestQuadBoundary=abs(mod(globalAngle+M_PI*0.25,M_PI*0.5)-M_PI*0.25);lowp float quadrantBlendStrength=exp(-nearestQuadBoundary*nearestQuadBoundary*2.0)*0.15;if(u_enMi){float mirrorDist=u_hoMiS==0?smoothstep(0.0,10.0,-abs(coord.x-u_tran.x)):smoothstep(0.0,10.0,abs(coord.x-u_tran.x));quadrantBlendStrength*=mirrorDist;}lowp vec2 quadDistortion=vec2(sin(globalAngle*3.0)*quadrantBlendStrength,cos(globalAngle*3.0)*quadrantBlendStrength)*globalDist*0.03;coord+=quadDistortion;lowp float gridDistortTime=(u_time*10.0)*u_soAnS;lowp vec2 gridDistortCoord=coord*u_soFr;lowp float distortNoise1=fbmsxNo(gridDistortCoord,2);lowp float distortNoise2=fbmsxNo(gridDistortCoord+vec2(1.0),2);lowp vec2 flowPattern=vec2(sin(gridDistortCoord.x*0.1+gridDistortTime)*cos(gridDistortCoord.y*0.08+gridDistortTime*0.5)*0.8,sin(gridDistortCoord.y*0.1+gridDistortTime*0.7)*cos(gridDistortCoord.x*0.08+gridDistortTime*0.3)*0.8)*distortNoise1;lowp vec2 gridOffset=flowPattern*u_soStr*u_celS;if(u_enMi){float mirrorDist=u_hoMiS==0?smoothstep(0.0,20.0,-abs(coord.x-u_tran.x)):smoothstep(0.0,20.0,abs(coord.x-u_tran.x));gridOffset.x*=mirrorDist;}coord+=gridOffset;lowp vec2 gridCoord=floor(coord/u_celS);lowp vec2 cellCenter=(gridCoord+0.5)*u_celS;lowp vec2 localPos=coord-cellCenter;vec2 caCoord=floor(cellCenter/100.0);float caState=fract(sin(dot(caCoord+vec2(u_nS),vec2(12.9898,78.233)))*43758.5453);float slowTime=u_time*u_soAnS*0.05;lowp vec2 cellFract=fract(coord/u_celS);lowp vec2 smoothFract=smoothstep(0.0,1.0,cellFract);lowp vec2 cellDist=abs(localPos);lowp float maxCellDist=max(cellDist.x,cellDist.y);float maxCellBoundary=u_celS*mix(0.4,0.9,0.5);float edgeDist=length(localPos)/maxCellBoundary;float fadeStart=0.4;float fadeEnd=1.0;float depthEffect=0.2;float baseFade=1.0-smoothstep(fadeStart,fadeEnd,edgeDist);vec2 normalizedPos=localPos/maxCellBoundary;float distFromCenter=length(normalizedPos);float z=sqrt(max(0.0,1.0-distFromCenter*distFromCenter));vec3 normal=normalize(vec3(normalizedPos.x,normalizedPos.y,z));vec3 mainLight=normalize(vec3(0.5,-0.5,1.0));vec3 rimLight=normalize(vec3(-0.5,0.5,0.2));float mainDiffuse=max(0.0,dot(normal,mainLight));float rimLighting=pow(1.0-dot(normal,vec3(0.0,0.0,1.0)),2.0);float specular=pow(max(0.0,dot(reflect(-mainLight,normal),vec3(0.0,0.0,1.0))),8.0);float lightIntensity=0.3+0.5*mainDiffuse+0.2*pow(mainDiffuse,2.0)+0.1*rimLighting+0.2*specular;float fadeAlpha=baseFade;fadeAlpha*=mix(0.4,1.0,lightIntensity);float edgeFade=1.0-smoothstep(0.7,0.95,distFromCenter);fadeAlpha*=edgeFade;float ao=1.0-smoothstep(0.5,0.9,distFromCenter);fadeAlpha*=mix(1.0,ao,0.2);fadeAlpha=pow(fadeAlpha,0.8);if(fadeAlpha<=0.001){discard;}fadeAlpha=clamp(fadeAlpha,0.0,1.0);fadeAlpha*=(1.0-smoothstep(0.8,1.0,edgeDist));lowp float fadeWidth=0.5;lowp float crossCellBlend=smoothstep(0.5,1.0,edgeDist);int quadrant=int(floor(atan(coord.y,coord.x)/(M_PI*0.5)+2.0));lowp float quadAngle=mod(atan(coord.y,coord.x)+M_PI,M_PI*0.5)/(M_PI*0.5);lowp float quadrantEdgeBlend=min(smoothstep(0.0,0.2,quadAngle),smoothstep(1.0,0.8,quadAngle));vec2 baseNoiseCoord=gridCoord*0.1+smoothFract*0.05;float crossCellQuadrantBlend=mix(crossCellBlend,1.0,quadrantEdgeBlend*0.5);float timeScale=u_time*0.1;vec2 timeOffset=vec2(timeScale,timeScale+10.0);vec2 neighborRight=gridCoord+vec2(1.0,0.0);vec2 neighborBottom=gridCoord+vec2(0.0,1.0);vec2 neighborDiagonal=gridCoord+vec2(1.0,1.0);vec2 baseNoiseCoordRight=neighborRight*0.1+vec2(smoothFract.x-1.0,smoothFract.y)*0.05;vec2 baseNoiseCoordBottom=neighborBottom*0.1+vec2(smoothFract.x,smoothFract.y-1.0)*0.05;vec2 baseNoiseCoordDiagonal=neighborDiagonal*0.1+vec2(smoothFract.x-1.0,smoothFract.y-1.0)*0.05;float distortionInfluence=length(gridOffset)/(u_celS*2.0);float baseNoiseFBM,baseNoiseFBMRight,baseNoiseFBMBottom,baseNoiseFBMDiagonal;if(u_fPat){baseNoiseFBM=0.5+caState*0.5;baseNoiseFBMRight=0.5+fract(caState*1.618)*0.5;baseNoiseFBMBottom=0.5+fract(caState*2.718)*0.5;baseNoiseFBMDiagonal=0.5+fract(caState*3.14159)*0.5;}else{baseNoiseFBM=fbmsxNo(gridCoord*(u_celS/u_res.y)*0.05,3)+distortionInfluence*0.2;baseNoiseFBMRight=fbmsxNo(neighborRight*(u_celS/u_res.y)*0.05,3)+distortionInfluence*0.4;baseNoiseFBMBottom=fbmsxNo(neighborBottom*(u_celS/u_res.y)*0.05,3)+distortionInfluence*0.8;baseNoiseFBMDiagonal=fbmsxNo(neighborDiagonal*(u_celS/u_res.y)*0.05,3)+distortionInfluence*0.6;}float blendRight,blendBottom;if(u_fPat){blendRight=step(0.5,smoothFract.x);blendBottom=step(0.5,smoothFract.y);}else{blendRight=mix(smoothstep(0.7,1.0,smoothFract.x),smoothstep(0.5,1.0,smoothFract.x),quadrantEdgeBlend*0.5);blendBottom=mix(smoothstep(0.7,1.0,smoothFract.y),smoothstep(0.5,1.0,smoothFract.y),quadrantEdgeBlend*0.5);}float blendedFBM=mix(mix(baseNoiseFBM,baseNoiseFBMRight,blendRight),mix(baseNoiseFBMBottom,baseNoiseFBMDiagonal,blendRight),blendBottom);vec2 noiseOffset,noiseOffsetRight,noiseOffsetBottom,noiseOffsetDiagonal;if(u_fPat){noiseOffset=vec2(0.0);noiseOffsetRight=vec2(0.0);noiseOffsetBottom=vec2(0.0);noiseOffsetDiagonal=vec2(0.0);}else{noiseOffset=vec2(noise(baseNoiseCoord+timeOffset.xx,u_nS),noise(baseNoiseCoord+timeOffset.yy,u_nS));noiseOffsetRight=vec2(noise(baseNoiseCoordRight+timeOffset.xx,u_nS),noise(baseNoiseCoordRight+timeOffset.yy,u_nS));noiseOffsetBottom=vec2(noise(baseNoiseCoordBottom+timeOffset.xx,u_nS),noise(baseNoiseCoordBottom+timeOffset.yy,u_nS));noiseOffsetDiagonal=vec2(noise(baseNoiseCoordDiagonal+timeOffset.xx,u_nS),noise(baseNoiseCoordDiagonal+timeOffset.yy,u_nS));}vec2 blendedNoiseOffset=mix(mix(noiseOffset,noiseOffsetRight,blendRight),mix(noiseOffsetBottom,noiseOffsetDiagonal,blendRight),blendBottom);float gridSize=u_celS*mix(0.3,2.5,blendedFBM);vec2 localCoord=mod(coord+blendedNoiseOffset,gridSize);float randomBase=noise(gridCoord+blendedNoiseOffset,u_nS);float nextCellRandom=noise(gridCoord+vec2(1.0)+blendedNoiseOffset,u_nS);float interpolatedRandom=mix(randomBase,nextCellRandom,smoothFract.x);interpolatedRandom=mix(interpolatedRandom,noise(gridCoord+vec2(0.0,1.0)+blendedNoiseOffset,u_nS),smoothFract.y);float randomAngleBase=interpolatedRandom*4.0;float sharpness=100.5;float crystalNoise=sin(randomAngleBase*M_PI)*sin(quadAngle*M_PI*3.0);float facetEdge=smoothstep(0.25,0.35,abs(crystalNoise));float smoothRegion=smoothstep(0.2,0.8,abs(sin(randomAngleBase*M_PI)));float smoothRandom=randomAngleBase+(facetEdge*sharpness*crystalNoise)+((1.0-facetEdge)*smoothRegion*0.5);float crystalStructure=step(0.7,max(abs(sin(quadAngle*M_PI*2.0)),abs(cos(quadAngle*M_PI*2.0))));float blendedAngle=(smoothRandom+crystalStructure*M_PI*0.25)*(M_PI*0.5);float sinA=sin(blendedAngle);float cosA=cos(blendedAngle);vec2 rotatedCoord=vec2(localCoord.x*cosA-localCoord.y*sinA,localCoord.x*sinA+localCoord.y*cosA);vec2 noiseInput1=rotatedCoord*((u_celS/u_res.y)*1.0)+u_time*0.0;vec2 noiseInput2=(rotatedCoord+gridCoord*gridSize)*((u_celS/u_res.y)*1.0)*u_noSc;float flowNoise=fbmsxNo(noiseInput1,6);float secondaryFlow=fbmsxNo(noiseInput2*0.5,3);flowNoise=mix(flowNoise,secondaryFlow,0.3);float detailNoise=fbmsxNo(noiseInput1*2.0,2);flowNoise=mix(flowNoise,detailNoise,0.15);vec2 animatedCoord=noiseInput2+vec2(sin(flowNoise*12.0+u_time*0.1)*cos(flowNoise*8.0),cos(flowNoise*12.0+u_time*0.12)*sin(flowNoise*8.0))*u_floS*0.006;float circularFlow=length(rotatedCoord)*0.1;animatedCoord+=vec2(cos(circularFlow+u_time*0.05),sin(circularFlow+u_time*0.05))*u_floS*0.002;lowp vec4 color=vec4(0.0);float baseNoise=fbmsxNo(animatedCoord*(u_celS/u_res.y)*0.2,6);vec2 adjAnimCoordR=(animatedCoord+vec2(u_celS,0))*(u_celS/u_res.y)*0.15;vec2 adjAnimCoordB=(animatedCoord+vec2(0,u_celS))*(u_celS/u_res.y)*0.15;vec2 adjAnimCoordRB=(animatedCoord+vec2(u_celS))*(u_celS/u_res.y)*0.15;float baseNoiseR=fbmsxNo(adjAnimCoordR,4);float baseNoiseB=fbmsxNo(adjAnimCoordB,4);float baseNoiseRB=fbmsxNo(adjAnimCoordRB,4);float edgeBlendX=mix(smoothstep(0.6,1.0,smoothFract.x),smoothstep(0.3,1.0,smoothFract.x),quadrantEdgeBlend*1.8);float edgeBlendY=mix(smoothstep(0.6,1.0,smoothFract.y),smoothstep(0.3,1.0,smoothFract.y),quadrantEdgeBlend*1.8);float cellCenterWeight=(1.0-smoothFract.x)*(1.0-smoothFract.y)*smoothFract.x*smoothFract.y*16.0;cellCenterWeight=pow(cellCenterWeight,0.5);float blendedBaseNoise=mix(mix(baseNoise,baseNoiseR,edgeBlendX),mix(baseNoiseB,baseNoiseRB,edgeBlendX),edgeBlendY);blendedBaseNoise=mix(blendedBaseNoise,(baseNoise+baseNoiseR+baseNoiseB+baseNoiseRB)*0.25,quadrantBlendStrength*0.8);float combinedNoise=(blendedBaseNoise*0.4+blendedFBM*0.6+3.0)*0.5;float clampedNoise=clamp(combinedNoise,0.0,1.0);float exactDepth=clamp(clampedNoise*float(u_maxDepth),1.0,min(float(u_maxDepth),float(MAX_LOOP_DEPTH)));int baseDepth=int(floor(exactDepth));float depthFrac=exactDepth-float(baseDepth);float threshold=0.55-(0.15*pow(1.0-u_bS,2.0));float t=0.5;float complexBlend=0.5;float blendFactor=complexBlend*(1.0+combinedNoise*0.8);float edgeRange=0.5;float edge0=0.3;float edge1=0.7;vec2 flowDir=getSFDir(cellCenter,u_time*5.0);float flowAngle=atan(flowDir.y,flowDir.x);bool needsFlowDirection=true;for(int depth=0;depth<MAX_LOOP_DEPTH;depth++){if(depth>baseDepth||color.a>0.95)break;float layerAlpha=1.0;if(depth==baseDepth){layerAlpha=depthFrac;}float depthNoiseValue=noise(animatedCoord*float(depth+1),u_nS);float depthFactor=float(depth)/float(MAX_LOOP_DEPTH-1);float cellBoundary=u_celS*mix(0.485,0.2,depthFactor);if(depthNoiseValue<threshold)continue;float currSize=(0.3+depthFactor*0.9)*u_celS;float organicAngle=-flowAngle+sin(length(localPos)+u_time*0.1)*0.5;mat2 flowRotation=mat2(cos(organicAngle),-sin(organicAngle),sin(organicAngle),cos(organicAngle));vec2 rotatedP=(depth<4)?flowRotation*localPos:localPos;float mappedOffset=0.5+0.5*length(flowDir);vec2 glyphCell=floor(rotatedP/currSize+mappedOffset);float pattern=getGPa(glyphCell,float(depth),u_nS,vteCd);bool insideGlyph=pattern>0.5||(abs(glyphCell.x)<0.5&&abs(glyphCell.y)<0.5);if(!insideGlyph)continue;vec2 normalizedPos=rotatedP/u_celS;float smoothedDepthFactor=smTran(depthFactor,depthFactor-0.016,0.25);float rawColorT=depthFactor+baseNoise*0.6;float smoothedColorT=smoothstep(0.0,1.0,smoothstep(edge0,edge1,rawColorT));vec3 color1=gCFPal(smoothedColorT,normalizedPos);vec3 color2=gCFPal(1.0-smoothedColorT,normalizedPos);float depthBoost=1.2+(1.0-depthFactor)*0.6;color1*=depthBoost;color2*=depthBoost;float stableBlendFactor=blendFactor;vec3 blendedColor;if(u_bMo==0){blendedColor=sMix(color1,color2,stableBlendFactor);}else if(u_bMo==1){blendedColor=ovrBl(color1,color2);}else if(u_bMo==2){blendedColor=cBBl(color1,color2);}else{blendedColor=sMix(color1,color2,stableBlendFactor);}float alphaFactor=1.0-depthNoiseValue*0.65;color.rgb=mix(color.rgb,blendedColor,alphaFactor*layerAlpha);color.a+=alphaFactor*(1.0-color.a)*layerAlpha;}if(color.a==0.0){color=u_baCo;}if(u_fPat){color.rgb=pow(color.rgb,vec3(0.8));float colorSum=color.r+color.g+color.b;float maxChannel=max(max(color.r,color.g),color.b);color.rgb=mix(color.rgb,vec3(color.r>0.5?1.0:0.0,color.g>0.5?1.0:0.0,color.b>0.5?1.0:0.0),0.2);}color.a*=fadeAlpha;color.rgb*=mix(0.2,1.0,fadeAlpha);color.rgb*=(0.85+lightIntensity*depthEffect);gl_FragColor=color;}
    </script>
    <script>
let bS=1;const cV=2;let tS,dM=3,cS,bN=.002,nS,fS=.005,rSS,roA,nOX,nOY,scF=30,tX=0,tY=0,smoothTX=0,smoothTY=0,columnMovementEnabled=!0,columnMovementStrength=1,columnMovementTime=0,randomMovementEnabled=!1,randomMoveDirection=0,randomMoveSpeed=2,iTX=0,iTY=0,amV=[.1,.075,.05],isP=!0,stT=0,cuT=0,soS=.1,soF=.2,soA=.1,cuP,currBlendMode=0;const TARGET_FRAMERATE=60;let lastFrameTime=0,currFPS=60,fpsUpdateTime=0;const FPS_UPDATE_INTERVAL=500;let canvasElement,glContext;const MEMORY_CLEANUP_INTERVAL=3e4;let lastMemoryCleanup=0,isMemoryCleanupScheduled=!1,isTabVisible=!0,mirrorEnabled=!0,verticalMirrorEnabled=!1,rafID=null,lastRenderTime=0,horizontalMirrorState=0,flatPatternEnabled=!1;function handleVisibilityChange(){(isTabVisible="visible"===document.visibilityState)&&(lastFrameTime=performance.now(),isP&&requestAnimationFrame(draw)),isTabVisible||performMemoryCleanup()}function performMemoryCleanup(){isMemoryCleanupScheduled=!0,setTimeout(()=>{if(recordingChunkIndex=0,glContext&&!isTabVisible){let $=pixelDensity();$>1&&(pixelDensity(1),clear(),pixelDensity($))}lastMemoryCleanup=performance.now(),isMemoryCleanupScheduled=!1,isTabVisible&&isP&&requestAnimationFrame(draw)},100)}const cachedUniforms={bS:null,scaleFactor:null,translation:[null,null],resolution:[null,null],time:null,cellSize:null,flowSpeed:null,sortStrength:null,sortFrequency:null,sortAnimSpeed:null,currPattern:null,noiseScale:null,caScaleVariation:null};let inscription_id=window.location.pathname.split("/").pop(),chars="0123456789abcdefghijklmnopqrstuvwsyz";inscription_id=new URLSearchParams(window.location.search).get("seed")||Array(64).fill(0).map($=>chars[Math.random()*chars.length|0]).join("");class Rnd{constructor($){let e=Math.imul,t=$=>{let t,r=0;for(t=1779033703^$.length;r<$.length;r++)t=(t=e(t^$.charCodeAt(r),3432918353))<<13|t>>>19;return()=>(t=e(t^t>>>16,2246822507),t=e(t^t>>>13,3266489909),(t^=t>>>16)>>>0)},r=($,e,t,r)=>()=>{let s=(($|=0)+(e|=0)|0)+(r|=0)|0;return r=r+1|0,$=e^e>>>9,e=(t|=0)+(t<<3)|0,t=(t=t<<21|t>>>11)+s|0,(s>>>0)/4294967296},s=t($);this.R=r(s(),s())}D=$=>this.R();N=($,e)=>$+(e-$)*this.D();I=($,e)=>0|this.N($,e+1);B=$=>this.D()<$}let R=new Rnd(inscription_id);function upTC(){}function geT(){let $=new Date,e=$=>$.toString().padStart(2,"0");return`${$.getFullYear()}${e($.getMonth()+1)}${e($.getDate())}_${e($.getHours())}${e($.getMinutes())}${e($.getSeconds())}`}function preload(){if(!tS){let $;tS=createShader(document.getElementById("vertex-shader").textContent,document.getElementById("fragment-shader").textContent)}}function suEH(){let $=canvasElement,e={keydown:null,keyup:null,mousedown:null,mousemove:null,mouseup:null,touchstart:null,touchmove:null,touchend:null,visibilitychange:null,resize:null},t=0,r=0,s=0,n=0,o=null,a=new Set;function i(){for(let[t,r]of Object.entries(e))r&&("resize"===t?window.removeEventListener(t,r):t.startsWith("touch")?$.removeEventListener(t,r,{passive:!1}):document.removeEventListener(t,r))}return i(),e.keydown=function $(e){if(!a.has(e.key))switch(a.add(e.key),e.key.toLowerCase()){case"a":dM=(dM+1)%4,requestAnimationFrame(upCS);break;case"r":tX=-width/2,tY=-height/2,smoothTX=0,smoothTY=0;break;case"s":isP?(cuT=(millis()-stT)/1e3,isP=!1):(stT=millis()-1e3*cuT,isP=!0,requestAnimationFrame(draw));break;case"m":setShaderUniform("u_hoMiS",horizontalMirrorState=(horizontalMirrorState+1)%2),setShaderUniform("u_enMi",!0),requestAnimationFrame(draw);break;case"1":case"2":case"3":{let t=pixelDensity(),r="1"===e.key?4:"2"===e.key?5:5.5;pixelDensity(r),draw();let s=geT(),n="Echo Chambers_"+inscription_id+("1"===e.key?"":"_hires_");saveCanvas(n+s,"png"),pixelDensity(t),draw();break}case"y":scF=30===scF?10:10===scF?5:30;break;case"b":setShaderUniform("u_bMo",currBlendMode=(currBlendMode+1)%3);let o;switch(currBlendMode){case 0:default:o="Normal";break;case 1:o="Overlay";break;case 2:o="Soft Light"}requestAnimationFrame(draw);break;case"x":setShaderUniform("u_fPat",flatPatternEnabled=!flatPatternEnabled),requestAnimationFrame(draw);break;case"d":columnMovementEnabled=!columnMovementEnabled,requestAnimationFrame(draw);break;case"f":(randomMovementEnabled=!randomMovementEnabled)&&null===rafID&&(rafID=requestAnimationFrame(draw));break;case"c":setRecordingQuality("high"),toggleRecording();break;case"q":savecurrPosition();let i={name:"Echo Chambers",inscriptionId:inscription_id,position:{tX,tY},aspectRatio:dM,zoom:scF,mode:dM,timestamp:geT()},l=JSON.stringify(i,null,2),h=new Blob([l],{type:"application/json"}),c=URL.createObjectURL(h),d=document.createElement("a");d.href=c,d.download=`Echo Chambers_${inscription_id}_capture.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c);break;case"e":restoreSavedPosition()}},e.keyup=function $(e){a.delete(e.key)},e.mousedown=function e(t){0===t.button&&(isDragging=!0,startX=t.clientX,startY=t.clientY,startTX=tX,startTY=tY,$.style.cursor="grabbing",t.preventDefault())},e.mousemove=function $(e){if(!isDragging)return;let t=e.clientX-startX,r=e.clientY-startY,s=scF/15;tX=startTX-t*s,tY=startTY+r*s,isP||null!==rafID||(rafID=requestAnimationFrame(draw))},e.mouseup=function e(t){isDragging&&(isDragging=!1,$.style.cursor="grab",isP||null!==rafID||(rafID=requestAnimationFrame(draw)))},e.touchstart=function $(e){if(1!==e.touches.length)return;let a=e.touches[0],i=performance.now();isDragging=!0,startX=a.clientX,startY=a.clientY,startTX=tX,startTY=tY;let l=Math.sqrt(Math.pow(a.clientX-r,2)+Math.pow(a.clientY-s,2));o&&clearTimeout(o),i-t<300&&l<30?2==++n?((isP=!isP)?(stT=.1*millis(),requestAnimationFrame(draw)):cuT=(millis()-stT)/1e3,isDragging=!1):3===n&&(dM=(dM+1)%4,requestAnimationFrame(upCS),n=0,isDragging=!1):n=1,t=i,r=a.clientX,s=a.clientY,o=setTimeout(()=>{n=0},300),e.preventDefault()},e.touchmove=function $(e){if(!isDragging||1!==e.touches.length)return;let t=e.touches[0],r=t.clientX-startX,s=t.clientY-startY,n=scF/15;tX=startTX-r*n,tY=startTY+s*n,isP||null!==rafID||(rafID=requestAnimationFrame(draw)),e.preventDefault()},e.touchend=function $(e){isDragging=!1,isP||null!==rafID||(rafID=requestAnimationFrame(draw)),e.preventDefault()},e.resize=function $(){reTO&&(clearTimeout(reTO),reTO=null),reTO=setTimeout(()=>{requestAnimationFrame(upCS)},100)},e.visibilitychange=handleVisibilityChange,document.addEventListener("keydown",e.keydown),document.addEventListener("keyup",e.keyup),document.addEventListener("mousedown",e.mousedown),document.addEventListener("mousemove",e.mousemove),document.addEventListener("mouseup",e.mouseup),$.addEventListener("touchstart",e.touchstart,{passive:!1}),$.addEventListener("touchmove",e.touchmove,{passive:!1}),$.addEventListener("touchend",e.touchend,{passive:!1}),window.addEventListener("resize",e.resize),document.addEventListener("visibilitychange",e.visibilitychange),$.style.cursor="grab",i}console.log("Inscription ID:",inscription_id);let MIN_RENDER_INTERVAL=1e3/60,isDragging=!1,startX,startY,startTX,startTY;function detectLowPerformanceDevice(){let $=performance.now();for(let e=0;e<1e4;e++);let t=performance.now()-$,r=t>20||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||/MSIE|Trident|Edge\/[1-14]/i.test(navigator.userAgent)||window.prevFrameRate&&window.prevFrameRate<15;return r}function setup(){let $=createCanvas(windowWidth,windowHeight,WEBGL);canvasElement=document.querySelector("canvas");let e=$.GL;if(glContext=e,MIN_RENDER_INTERVAL=1e3/60,setShaderUniform("u_reQu",1),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.disable(e.DITHER),e.disable(e.STENCIL_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.hint(e.GENERATE_MIPMAP_HINT,e.FASTEST),pixelDensity(2),setShaderUniform("u_fPat",!1),"undefined"!=typeof MediaRecorder&&(lastMemoryCleanup=performance.now(),document.addEventListener("visibilitychange",handleVisibilityChange)),noStroke(),tS||(tS=createShader(document.getElementById("vertex-shader").textContent,document.getElementById("fragment-shader").textContent)),shader(tS),setShaderUniform("u_enDWa",!1),setShaderUniform("u_enableGridDistort",!1),mirrorEnabled=!0,setShaderUniform("u_enMi",!0),verticalMirrorEnabled=!1,setShaderUniform("u_enVMi",!1),!inscription_id)return;setShaderUniform("u_cuPa",cuP=R.I(0,5),"currPattern"),upCS(),suEH(),nOX=R.I(0,2e3),nOY=R.I(0,2e3);let t=-width/2,r=-height/2;iTX=t,iTY=r,tX=t,tY=r,setShaderUniform("u_sTran",[smoothTX=0,smoothTY=0]),setShaderUniform("u_coMvT",0),setShaderUniform("u_coMvS",columnMovementEnabled?columnMovementStrength:0),randomMovementEnabled=!0,randomMoveDirection=(R.B(.5),1),nS=R.I(0,1e3),rSS=R.I(0,1e3),roA=R.I(0,360);let s=amV[R.I(0,amV.length-1)],n=[5e-4,1e-4,.005][R.I(0,2)];cS=windowHeight/2,bN=[.01,.009,.007,.005,.003][R.I(0,4)];let o=R.N(.5,2);function a($,e){let t=$[0]-e[0],r=$[1]-e[1],s=$[2]-e[2];return Math.sqrt(t*t+r*r+s*s)}function i($,e,t){let r,s,n,o=Math.floor(6*$),a=6*$-o,i=t*(1-e),l=t*(1-a*e),h=t*(1-(1-a)*e);switch(o%6){case 0:r=t,s=h,n=i;break;case 1:r=l,s=t,n=i;break;case 2:r=i,s=t,n=h;break;case 3:r=i,s=l,n=t;break;case 4:r=h,s=i,n=t;break;case 5:r=t,s=i,n=l}return[r,s,n]}function l($="light",e=null,t=[],r=!1){let s=0;function n($){if(0===$.length)return R.D();let e=0,t=0;for(let r=0;r<15;r++){let s=R.D(),n=1;for(let o of $){let a=Math.abs(s-o);n=Math.min(n,a=Math.min(a,1-a))}n>t&&(t=n,e=s)}return e}for(;s<15;){let o=t.map($=>{let e=Math.max(...$),t=Math.min(...$),r=e-t,s;return(s=60*(s=0===r?0:e===$[0]?($[1]-$[2])/r%6:e===$[1]?($[2]-$[0])/r+2:($[0]-$[1])/r+4)/360)<0&&(s+=1),s}),i;if("mid"===$&&null!==e){let l=R.N(.48,.52);i=(e+l)%1}else i=n(o);let h=R.N(.95,1),c;if(r)c=R.N(.05,.15);else switch($){case"dark":c=R.N(.2,.35);break;case"mid":c=R.N(.6,.8);break;case"light":c=R.N(.9,1)}let d=Math.floor(6*i),u=6*i-d,_=c*(1-h),v=c*(1-u*h),m=c*(1-(1-u)*h),f,S,p;switch(d%6){case 0:f=c,S=m,p=_;break;case 1:f=v,S=c,p=_;break;case 2:f=_,S=c,p=m;break;case 3:f=_,S=v,p=c;break;case 4:f=m,S=_,p=c;break;case 5:f=c,S=_,p=v}let g=[f,S,p],b=!0;for(let y of t)if(.6>a(g,y)){b=!1;break}if(b||14===s)return{color:g,hue:i};s++}}let h=[[.05,.05,.05,1],[.9,.87,.82,1]][.6>R.D()?0:1],c=h[0]>.5,d=[100],u=R.I(0,d.length-1),_=d[u],v=function $(e=!1){let t={pal1:{type:"Fluo",colors:[{h:.573,s:.976,v:.922},{h:.972,s:.667,v:.031},{h:.515,s:.887,v:.973},{h:.663,s:.833,v:.745},{h:.5,s:.282,v:1},{h:.005,s:.829,v:.741},{h:.084,s:.294,v:.906},{h:.052,s:1,v:.906},{h:.002,s:.576,v:1},{h:.735,s:.423,v:.918}]},pal4:{type:"Fluo",colors:[{h:.149,s:.965,v:1},{h:.667,s:0,v:.016},{h:.722,s:.636,v:.569},{h:.995,s:.668,v:.855},{h:.239,s:.118,v:.922},{h:.149,s:1,v:.961},{h:.167,s:.676,v:.451},{h:.091,s:.906,v:.882},{h:.267,s:.2,v:1},{h:.167,s:0,v:.996}]},pal5:{type:"Fluo",colors:[{h:.167,s:.25,v:.996},{h:.932,s:.614,v:.984},{h:.82,s:.769,v:.757},{h:.042,s:.169,v:.98},{h:.024,s:.689,v:.976},{h:.148,s:.957,v:.996},{h:.535,s:.871,v:.969},{h:.486,s:.663,v:.831},{h:.723,s:.871,v:.537},{h:.367,s:.518,v:.953}]},pal6:{type:"Fluo",colors:[{h:.25,s:.048,v:.969},{h:.466,s:.643,v:.984},{h:.667,s:1,v:.996},{h:.975,s:.718,v:1},{h:.994,s:.314,v:.996},{h:.108,s:.522,v:1},{h:.667,s:.048,v:.906},{h:.531,s:.5,v:.855},{h:.222,s:.694,v:.976},{h:.167,s:1,v:.949}]},pal7:{type:"Triadic",colors:[{h:.684,s:.377,v:.886},{h:.5686,s:1,v:.647},{h:.611,s:.75,v:.329},{h:.75,s:.814,v:.82},{h:.811,s:.463,v:.333},{h:.861,s:.167,v:.561},{h:.733,s:.333,v:.345},{h:.733,s:.333,v:.345},{h:.747,s:.702,v:.906},{h:.012,s:.935,v:.6}]},pal8:{type:"Triadic",colors:[{h:.773,s:.897,v:.831},{h:.149,s:.792,v:.957},{h:.125,s:.424,v:.992},{h:.007,s:.811,v:.871},{h:.508,s:1,v:.361},{h:.017,s:.617,v:.741},{h:0,s:1,v:.384},{h:.856,s:.943,v:.447},{h:.422,s:.685,v:.592},{h:.694,s:.857,v:.169}]},pal9:{type:"Triadic",colors:[{h:.875,s:.833,v:.02},{h:.986,s:.5,v:.094},{h:.992,s:.667,v:.31},{h:.019,s:.837,v:.608},{h:.727,s:.737,v:.6},{h:.102,s:.667,v:.918},{h:.033,s:.402,v:.98},{h:.028,s:.368,v:.961},{h:.042,s:.196,v:.969},{h:.123,s:.612,v:1}]},pal11:{type:"Monochrome",colors:[{h:.936,s:.771,v:.647},{h:.936,s:.771,v:.647},{h:.947,s:.655,v:.831},{h:.076,s:1,v:.949},{h:.944,s:.4,v:1},{h:.947,s:.402,v:.922},{h:.947,s:.176,v:.984},{h:.936,s:.108,v:.949},{h:0,s:0,v:.973},{h:.083,s:.757,v:.973}]},pal12:{type:"Spectrum",colors:[{h:.005,s:.776,v:.988},{h:.076,s:1,v:.949},{h:.029,s:.961,v:.776},{h:.872,s:.871,v:.565},{h:.002,s:.592,v:.984},{h:.911,s:.556,v:.373},{h:.987,s:.611,v:.918},{h:.936,s:.35,v:.984},{h:.928,s:.579,v:.584},{h:.497,s:.759,v:.965}]},pal13:{type:"Monochrome",colors:[{h:.7,s:.9,v:.1},{h:.7,s:.9,v:.2},{h:.7,s:.9,v:.3},{h:.7,s:.9,v:.85},{h:.7,s:.9,v:.15},{h:.7,s:.9,v:.3},{h:.7,s:.05,v:.7},{h:.7,s:.05,v:.8},{h:.7,s:.05,v:.2},{h:.7,s:.05,v:1}]},pal14:{type:"Monochrome",colors:[{h:.08,s:.02,v:1},{h:.08,s:.02,v:.9},{h:.08,s:.02,v:.8},{h:.08,s:.02,v:.7},{h:.08,s:.02,v:.6},{h:.08,s:.02,v:.5},{h:.08,s:.02,v:.4},{h:.08,s:.02,v:.3},{h:.08,s:.02,v:.35},{h:.08,s:.02,v:.95}]},pal15:{type:"Monochrome",colors:[{h:0,s:0,v:.973},{h:.417,s:.033,v:.576},{h:0,s:0,v:.882},{h:.833,s:.167,v:.394},{h:.958,s:.091,v:.496},{h:.042,s:.118,v:.796},{h:.042,s:.136,v:.682},{h:.083,s:.296,v:.624},{h:0,s:0,v:1},{h:.139,s:.059,v:.992}]},pal16:{type:"Monochrome",colors:[{h:.6,s:.2,v:1},{h:.605,s:.25,v:.9},{h:.605,s:.3,v:.8},{h:.61,s:.35,v:.7},{h:.61,s:.4,v:.6},{h:.615,s:.45,v:.5},{h:.615,s:.5,v:.4},{h:.62,s:.55,v:.3},{h:.62,s:.6,v:.2},{h:.625,s:.65,v:.15}]},pal17:{type:"Spectrum",colors:[{h:.139,s:.039,v:.949},{h:.861,s:.571,v:.11},{h:.958,s:.945,v:.913},{h:.025,s:.686,v:.996},{h:.119,s:.655,v:.957},{h:.55,s:.835,v:.929},{h:.428,s:.792,v:.776},{h:.133,s:.541,v:.969},{h:.431,s:.627,v:.925},{h:.217,s:.287,v:.988}]},pal18:{type:"Spectrum",colors:[{h:.146,s:1,v:1},{h:.381,s:.238,v:.788},{h:.418,s:.583,v:.463},{h:.483,s:.51,v:.612},{h:.827,s:.727,v:.494},{h:.028,s:.705,v:.761},{h:.994,s:.771,v:.365},{h:.78,s:.833,v:.188},{h:.058,s:.71,v:.992},{h:.892,s:.92,v:.925}]},pal19:{type:"Spectrum",colors:[{h:0,s:.95,v:.95},{h:.1,s:.95,v:.95},{h:.17,s:.95,v:.95},{h:.33,s:.95,v:.9},{h:.43,s:.9,v:.85},{h:.5,s:.9,v:.9},{h:.6,s:.95,v:.95},{h:.7,s:.9,v:.9},{h:.8,s:.95,v:.85},{h:.9,s:.95,v:.9}]}},r=Object.keys(t),s=r[R.I(0,r.length-1)],n=t[s],o=[],a=R.I(0,9);for(let l=0;l<10;l++){let h=(l+a)%10,c=n.colors[h],d=R.N(-.01,.01),u=R.N(-.02,.02),_=R.N(-.02,.02),v=(c.h+d)%1,m=Math.min(Math.max(c.s+u,0),1),f=Math.min(Math.max(c.v+_,0),1);o.push(i(v,m,f))}return{name:s,type:n.type,colors:o,rC1:o[0],rC2:o[4],rC3:o[8]}}(c);rC1=v.rC1,rC2=v.rC2,rC3=v.rC3,setShaderUniform("u_nS",nS),setShaderUniform("u_rSS",rSS),setShaderUniform("u_roA",radians(roA)),setShaderUniform("u_nOS",[nOX,nOY]),setShaderUniform("u_amp",s),setShaderUniform("u_maxDepth",4),setShaderUniform("u_inFr",n),setShaderUniform("u_baMo",o),setShaderUniform("u_baCo",h),setShaderUniform("u_isLBa",c),setShaderUniform("u_cuPa",cuP=0),setShaderUniform("u_rC1",v.colors[0]),setShaderUniform("u_rC2",v.colors[1]),setShaderUniform("u_rC3",v.colors[2]),setShaderUniform("u_rC4",v.colors[3]),setShaderUniform("u_rC5",v.colors[4]),setShaderUniform("u_rC6",v.colors[5]),setShaderUniform("u_rC7",v.colors[6]),setShaderUniform("u_rC8",v.colors[7]),setShaderUniform("u_rC9",v.colors[8]),setShaderUniform("u_rC10",v.colors[9]),setShaderUniform("u_soStr",soS),setShaderUniform("u_soFr",soF),setShaderUniform("u_soAnS",soA),setShaderUniform("u_cuNoSc",_),scF=30,upTC(),stT=millis();setShaderUniform("u_caSVa",R.N(.5,5)),setShaderUniform("u_hoMiS",horizontalMirrorState=0),setShaderUniform("u_enMi",!0),setShaderUniform("u_enVMi",!1);setShaderUniform("u_patRC",R.N(2,9)),setShaderUniform("u_bMo",0),requestAnimationFrame(draw)}function draw(){if(!isTabVisible)return;if(randomMovementEnabled){let $=randomMoveSpeed;switch(randomMoveDirection){case 0:smoothTX+=$;break;case 1:smoothTY-=$;break;case 2:smoothTX-=$;break;case 3:smoothTY+=$}}null!==rafID&&(cancelAnimationFrame(rafID),rafID=null),(isP||isDragging||randomMovementEnabled)&&(rafID=requestAnimationFrame(draw));let e=performance.now(),t=e-lastFrameTime;if(e-lastRenderTime<MIN_RENDER_INTERVAL)return;lastRenderTime=e,e-fpsUpdateTime>500&&(currFPS=1e3/(t||1),fpsUpdateTime=e),e-lastMemoryCleanup>=3e4&&performMemoryCleanup(),lastFrameTime=e,clear(),background(0),isP&&(cuT=(millis()-stT)/1e3);let r=cuT;setShaderUniform("u_bS",bS),setShaderUniform("u_scFa",scF);let s=height/2*bS;tX=Math.round(tX/s)*s,setShaderUniform("u_celS",s),setShaderUniform("u_tran",[tX,tY]),setShaderUniform("u_sTran",[smoothTX,smoothTY]),columnMovementEnabled?(setShaderUniform("u_coMvT",columnMovementTime+=.02),setShaderUniform("u_coMvS",columnMovementStrength)):setShaderUniform("u_coMvS",0),setShaderUniform("u_res",[width,height]),setShaderUniform("u_time",r),setShaderUniform("u_floS",fS),setShaderUniform("u_soStr",soS),setShaderUniform("u_soFr",soF),setShaderUniform("u_soAnS",soA),setShaderUniform("u_cuPa",cuP);setShaderUniform("u_noSc",bN*(100/floor(height/2))),beginShape(),vertex(0,0,0,0,0),vertex(2,0,0,1,0),vertex(2,2,0,1,1),vertex(0,2,0,0,1),endShape(CLOSE)}function upCS(){let $=windowWidth/windowHeight,e,t,r=tX,s=tY;switch(dM){case 0:$>.75?(t=windowHeight,e=.75*windowHeight):(e=windowWidth,t=windowWidth*(4/3));break;case 1:$>1?(t=windowHeight,e=windowHeight):(e=windowWidth,t=windowWidth);break;case 2:$>4/3?(t=windowHeight,e=windowHeight*(4/3)):(e=windowWidth,t=.75*windowWidth);break;case 3:e=windowWidth,t=windowHeight}if(width!==e||height!==t){let n=(r+width/2)/width,o=(s+height/2)/height;resizeCanvas(e,t),tX=n*e-e/2,tY=o*t-t/2,canvasElement&&(canvasElement.style.cssText="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)"),requestAnimationFrame(draw)}}let reTO;function windowResized(){reTO&&(clearTimeout(reTO),reTO=null),reTO=setTimeout(()=>{requestAnimationFrame(upCS)},100)}function savecurrPosition(){let $={tX:tX,tY:tY,scF:scF,dM:dM,inscriptionId:inscription_id};try{localStorage.setItem(`position_${inscription_id}`,JSON.stringify($))}catch(e){}}function restoreSavedPosition(){try{let $=localStorage.getItem(`position_${inscription_id}`);if(!$)return;let e=JSON.parse($);tX=e.tX||-width/2,tY=e.tY||-height/2,scF=e.scF||30,"number"==typeof e.dM&&(dM=e.dM,requestAnimationFrame(upCS)),requestAnimationFrame(draw)}catch(t){}}function setShaderUniform($,e,t=null){let r=t||$.replace("u_","");Array.isArray(e)?(!cachedUniforms[r]||e.some(($,e)=>$!==cachedUniforms[r][e]))&&(cachedUniforms[r]=[...e],tS.setUniform($,e)):cachedUniforms[r]!==e&&(cachedUniforms[r]=e,tS.setUniform($,e))}let mediaRecorder,recordedChunks=[],isRecording=!1,recordingQuality="high";function startRecording(){let $=document.querySelector("canvas");recordedChunks=[],$.width,$.height;let e=$.captureStream(60);(mediaRecorder=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:8e6})).ondataavailable=$=>{$.data.size>0&&recordedChunks.push($.data)},mediaRecorder.onstop=saveVideo,mediaRecorder.start(1e3),isRecording=!0}function stopRecording(){mediaRecorder&&isRecording&&(mediaRecorder.stop(),isRecording=!1)}function saveVideo(){let $=new Blob(recordedChunks,{type:"video/webm"}),e=new Date,t=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}_${e.getHours().toString().padStart(2,"0")}-${e.getMinutes().toString().padStart(2,"0")}`,r=URL.createObjectURL($),s=document.createElement("a");document.body.appendChild(s),s.style.display="none",s.href=r,s.download=`Echo Chambers_${inscription_id}_animation_${t}_${recordingQuality}.webm`,s.click(),window.URL.revokeObjectURL(r),document.body.removeChild(s)}function toggleRecording(){isRecording?stopRecording():startRecording()}function setRecordingQuality($){recordingQuality=$}!function(){let $=null;function e(e){$||($=document.getElementById("keyboard-controls-panel")),$&&($.style.display=e?"block":"none")}document.addEventListener("DOMContentLoaded",function(){$=document.getElementById("keyboard-controls-panel"),e(!1)}),document.addEventListener("keydown",function(t){if(t.key&&("i"===t.key||"I"===t.key)&&($||($=document.getElementById("keyboard-controls-panel")),$)){let r="none"!==$.style.display;e(!r)}})}();
    </script>
  </body>
</html>
